% vim: ft=tex
\PassOptionsToPackage{prologue,dvipsnames}{xcolor}
\documentclass[acmsmall,natbib=false,review,anonymous]{acmart}
\input{../prelude.tex}

\newcommand{\ottDir}{../ott/_gen}
\newcommand{\genDir}{_gen}
\input{\ottDir/defs.tex}
\input{\ottDir/renew-ott.tex}

\begin{document}


\section{Syntax}

  \begin{supertabular}{rll p{0.8\textwidth}}
    \otte\\
    \ottA\\
  \end{supertabular}

\newpage

\section{Well-formedness}

  To formulate the completeness properties (at some point in the future),
  we need to restrict the `implicit' binders $\lambda^{\forall}$ and $\forall$ 
  to bind variables that are at safe positions in the body.
  For this purpose, we define the well-formedness relation.

  Here $V$ is a set of variables, 
  $sV$ is a set of variables 
  that need to be in the safe positions.
  Overall, we wish to guarantee that 
  after normalization,
  substitution of safe variables
  does not produce new redexes. 

  The constructor forms are well-formed by congruence:
  if their components are well-formed.
  Notice that $\lambda^{\forall}$ and $\forall$ require 
  the bound variable to be safe in the body.

  The eliminator forms are well-formed 
  if their components are well-formed and 
  one of the following conditions hold:
  \begin{itemize}
    \item they do not contain variables that are required to be safe
    \item they are \emph{inert} (see below), which implies that 
      their outer structure withstands reduction and 
      substitution of safe variables.
  \end{itemize}

    \ottdefnWfWFLabeled{}

  The types are not eliminated, so they behave as 
  constructor forms: they are well-formed by congruence.

    \ottdefnWfTWFLabeled{}

    The variables are always inert.
    The constructor forms are always inert. 
    The eliminator forms forbid their eliminated component to be a safe variable
    or a constructor form, and require it to be inert. 
    This way, if we assume that the term is well-typed, 
    the eliminated component must be either an unsafe variable or 
    another inert eliminator form.

    \ottdefnWfInertLabeled{}
\newpage

\section{Reduction}
  
  In the reduction, we first reduce the
  components of terms (congruence rules).
  Then, if the outer structure is an eliminator form,
  there are several rules where something interesting happens:
  \begin{ottdefnblock}[#2]{\ottdefnHeaderRedRed}{}
    \ottusedrule{\ottdruleRedRedAppLamLabeled[#1]{}}
    \ottusedrule{\ottdruleRedRedAppPLamLabeled[#1]{}}
    \ottusedrule{\ottdruleRedRedLRedSafeLabeled[#1]{}}
    \ottusedrule{\ottdruleRedRedLRedNeutLabeled[#1]{}}
    \ottusedrule{\ottdruleRedRedLRedGrLabeled[#1]{}}
    \ottusedrule{\ottdruleRedRedLNotinLabeled[#1]{}}
  \end{ottdefnblock}
  (Here $cE$ is an evaluation context, i.e. a term with a hole 
  in a term position; $cE \, \ottkw{is} \, \ottkw{safe}$ means that the hole is in a safe position)

  The invariant that we are preserving is that 
  \begin{itemize}
    \item reduction does not eliminate metavariables
    \item reduction preserves safety of the metavariables
  \end{itemize}

\end{document}